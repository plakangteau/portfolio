<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìˆ ê°’ ëˆ„ê°€ ë‚¼ë˜? - ìµœì¢… ì™„ì„±ë³¸</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background-color: #fef9e7; margin-top: 50px; overflow-x: hidden; }
        h1 { color: #e91e63; font-size: 3.5rem; margin-bottom: 80px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        #wheel-container { position: relative; width: 440px; height: 440px; margin: 0 auto; }
        canvas { border-radius: 50%; border: none; display: block; }
        #arrow {
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 25px solid transparent;
            border-right: 25px solid transparent; border-top: 50px solid #333; z-index: 10;
        }
        .controls { margin-top: 50px; background: white; display: inline-block; padding: 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        input[type="text"] { padding: 10px; margin: 5px; border: 2px solid #eee; border-radius: 8px; width: 90px; font-weight: bold; }
        input[type="number"] { padding: 8px; width: 50px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; }
        button {
            background-color: #e91e63; color: white; border: none; padding: 18px 40px;
            font-size: 1.4rem; font-weight: bold; border-radius: 50px; cursor: pointer;
            transition: all 0.2s; margin-top: 25px; box-shadow: 0 4px 0 #c2185b;
        }
        button:active { transform: translateY(3px); box-shadow: none; }
        #sound-notice { font-size: 0.9rem; color: #888; margin-top: 10px; }
    </style>
</head>
<body onclick="initAudio()">

    <h1>ìˆ ê°’ ëˆ„ê°€ ë‚¼ë˜?</h1>

    <div id="wheel-container">
        <div id="arrow"></div>
        <canvas id="wheel" width="440" height="440"></canvas>
    </div>

    <div class="controls">
        <div style="margin-bottom: 20px; font-size: 1.1rem; font-weight: bold;">
            ì¸ì›ìˆ˜: <input type="number" id="member-count" value="4" min="2" max="10" onchange="createInputs()"> ëª…
        </div>
        <div id="name-inputs"></div>
        <button id="spin-btn" onclick="spinWheel()">ëŒë ¤ ëŒë ¤ ëŒë¦¼íŒ!</button>
        <p id="sound-notice">ğŸ”ˆ ì†Œë¦¬ê°€ ì•ˆ ë‚˜ë©´ í™”ë©´ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­í•´ ì£¼ì„¸ìš”!</p>
    </div>

    <audio id="bgm" loop preload="auto"><source src="https://assets.mixkit.co/music/preview/mixkit-circus-theme-playful-56.mp3" type="audio/mpeg"></audio>
    <audio id="drumroll" preload="auto"><source src="https://www.soundjay.com/misc/sounds/drum-roll-01.mp3" type="audio/mpeg"></audio>
    <audio id="fanfare" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-stadium-crowd-clapping-and-cheering-463.mp3" type="audio/mpeg"></audio>

    <script>
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const colors = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40", "#8BC34A", "#F44336", "#FFCDD2", "#00BCD4"];
        
        let currentAngle = 0;
        let isSpinning = false;
        let audioInitialized = false;

        // ë¸Œë¼ìš°ì € ì†Œë¦¬ ì ê¸ˆ í•´ì œ
        function initAudio() {
            if (!audioInitialized) {
                const bgm = document.getElementById('bgm');
                bgm.volume = 0.4;
                bgm.play().catch(() => {});
                document.getElementById('sound-notice').innerText = "âœ… ì‚¬ìš´ë“œ í™œì„±í™”ë¨";
                audioInitialized = true;
            }
        }

        function createInputs() {
            const count = document.getElementById('member-count').value;
            const container = document.getElementById('name-inputs');
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.value = `ì‚¬ëŒ${i+1}`;
                input.className = 'name-field';
                input.oninput = drawWheel;
                container.appendChild(input);
            }
            setTimeout(drawWheel, 0);
        }

        function drawWheel() {
            const names = Array.from(document.getElementsByClassName('name-field')).map(i => i.value || '??');
            const numSegments = names.length;
            const arcSize = (2 * Math.PI) / numSegments;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            names.forEach((name, i) => {
                const angle = currentAngle + (i * arcSize);
                ctx.beginPath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, 215, angle, angle + arcSize);
                ctx.fill();

                ctx.save();
                ctx.translate(centerX, centerY);
                let textAngle = angle + arcSize / 2;
                ctx.rotate(textAngle);
                ctx.textAlign = "center";
                ctx.fillStyle = "#fff";
                ctx.font = "bold 20px Arial";

                const checkAngle = (textAngle % (2 * Math.PI) + (2 * Math.PI)) % (2 * Math.PI);
                if (checkAngle > Math.PI / 2 && checkAngle < (Math.PI * 3) / 2) {
                    ctx.translate(140, 0);
                    ctx.rotate(Math.PI);
                    ctx.fillText(name, 0, 5);
                } else {
                    ctx.fillText(name, 140, 5);
                }
                ctx.restore();
            });
        }

        function spinWheel() {
            if (isSpinning) return;
            
            // ì†Œë¦¬ ì¬ìƒ ê¶Œí•œ ê°•ì œ íšë“
            const bgm = document.getElementById('bgm');
            const drum = document.getElementById('drumroll');
            const fanfare = document.getElementById('fanfare');
            
            bgm.volume = 0.1;
            drum.currentTime = 0;
            drum.play().catch(() => {});

            isSpinning = true;
            const spinAngle = Math.random() * 360 + 1800;
            const duration = 4000; 
            const start = performance.now();
            const startAngle = currentAngle;

            function animate(time) {
                const elapsed = time - start;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 4);
                
                currentAngle = startAngle + (spinAngle * (Math.PI / 180) * easeOut);
                drawWheel();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    drum.pause();
                    bgm.volume = 0.4;
                    determineWinner();
                }
            }
            requestAnimationFrame(animate);
        }

        function determineWinner() {
            const names = Array.from(document.getElementsByClassName('name-field')).map(i => i.value || '??');
            const numSegments = names.length;
            const arcSize = (2 * Math.PI) / numSegments;
            const normalizedAngle = (currentAngle % (2 * Math.PI) + (2 * Math.PI)) % (2 * Math.PI);
            const arrowAngle = (Math.PI * 1.5); 
            
            let winnerIndex = Math.floor(((arrowAngle - normalizedAngle + (2 * Math.PI)) % (2 * Math.PI)) / arcSize);
            const winnerName = names[winnerIndex];
            
            document.getElementById('fanfare').play().catch(() => {});
            
            setTimeout(() => {
                alert(`ğŸŠ [${winnerName}] ë‹˜ ë‹¹ì²¨! ğŸŠ\nì˜ë¨¹ì„ê²Œìš”~~!`);
            }, 200);
        }

        window.onload = createInputs;
    </script>
</body>
</html>